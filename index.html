<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 2rem;
    }
    .logo {
      display: flex;
      align-items: flex-start;
      margin-top: -6rem;
      margin-bottom: -3.5rem;
      margin-left: -1.2rem;
    }
    .logo img {
      height: 300px;
    }
    label, input, button {
      display: block;
      margin: 1rem 0 0.5rem;
    }
    .selector-container {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }
    .dimension-buttons, .tjocklek-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .dimension-buttons button, .tjocklek-buttons button {
      padding: 0.3rem 0.6rem;
      background-color: #fff;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      min-width: 2.5rem;
      min-height: 1.8rem;
    }
    .dimension-buttons button.active, .tjocklek-buttons button.active {
      background-color: #444;
      color: #fff;
    }
    .dimension-buttons button.error, .tjocklek-buttons button.error {
      border: 2px solid red;
    }
    .result {
      margin-top: 2rem;
      white-space: pre-line;
    }
    .bold {
      font-weight: bold;
      text-decoration: underline;
    }
    .navigation-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    .warning {
      color: red;
      font-weight: bold;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="logo.png" alt="Perssons logotyp" />
  </div>

  <label for="plank">Antal plank:</label>
  <input type="number" id="plank" />
  <div class="warning" id="varning"></div>

  <div class="selector-container">
    <div>
      <label>Välj dimension:</label>
      <div class="dimension-buttons" id="dimension-buttons"></div>
    </div>
    <div>
      <label>Välj tjocklek:</label>
      <div class="tjocklek-buttons" id="tjocklek-buttons"></div>
    </div>
  </div>

  <label>Brädor till kund(er):</label>
  <div class="kund-controls">
    <button onclick="laggTillKund()">+</button>
    <button onclick="taBortKund()">–</button>
  </div>
  <div id="kund-container"></div>

  <button onclick="berakna()">Beräkna</button>

  <div class="result" id="kundOut"></div>
  <div class="result" id="restOut"></div>

  <div class="navigation-buttons">
    <button onclick="visaForra()">Föregående paket</button>
    <button onclick="visaNasta()">Nästa paket</button>
  </div>

  <script>
    const bradorPerLager = { 4: 11, 5: 9, 6: 7, 7: 6, 8: 5, 9: 5 };
    let valdDimension = 0;
    let valdTjocklek = 0;
    let paketLista = [];
    let aktuellIndex = 0;

    const knappContainer = document.getElementById('dimension-buttons');
    [4,5,6,7,8,9].forEach(d => {
      const btn = document.createElement('button');
      btn.textContent = d;
      btn.onclick = () => {
        valdDimension = d;
        document.querySelectorAll('.dimension-buttons button').forEach(b => b.classList.remove("active", "error"));
        btn.classList.add("active");
      };
      knappContainer.appendChild(btn);
    });

    const tjocklekContainer = document.getElementById('tjocklek-buttons');
    [21, 28].forEach(t => {
      const btn = document.createElement('button');
      btn.textContent = t;
      btn.onclick = () => {
        valdTjocklek = t;
        document.querySelectorAll('.tjocklek-buttons button').forEach(b => b.classList.remove("active", "error"));
        btn.classList.add("active");
      };
      tjocklekContainer.appendChild(btn);
    });

    function laggTillKund() {
      const container = document.getElementById("kund-container");
      const input = document.createElement("input");
      input.type = "number";
      input.className = "kund-input";
      input.placeholder = "Antal brädor";
      container.appendChild(input);
    }

    function taBortKund() {
      const container = document.getElementById("kund-container");
      const inputs = container.getElementsByClassName("kund-input");
      if (inputs.length > 0) {
        container.removeChild(inputs[inputs.length - 1]);
      }
    }

    function paketfordelning(lager, minLager, maxLager) {
      if (lager < minLager) return [lager];
      for (let antal = 1; antal <= lager; antal++) {
        let bas = Math.floor(lager / antal);
        if (bas < minLager || bas > maxLager) continue;
        let lista = Array(antal).fill(bas);
        let extra = lager - bas * antal;
        for (let i = 0; i < lista.length && extra > 0; i++) {
          if (lista[i] < maxLager) {
            lista[i]++;
            extra--;
          }
        }
        if (extra === 0) return lista;
      }
      return [lager];
    }

    function berakna() {
      const kundOut = document.getElementById("kundOut");
      const restOut = document.getElementById("restOut");
      const varning = document.getElementById("varning");
      kundOut.textContent = "";
      restOut.textContent = "";
      varning.textContent = "";

      const plank = parseInt(document.getElementById("plank").value) || 0;
      const kundInputs = document.querySelectorAll(".kund-input");
      const kundVarden = Array.from(kundInputs).map(input => parseInt(input.value) || 0).filter(v => v > 0);

      if (!plank) {
        kundOut.textContent = "Fyll i antal plank.";
        return;
      }
      if (!valdDimension) {
        kundOut.textContent = "Välj en dimension.";
        document.querySelectorAll('.dimension-buttons button').forEach(b => b.classList.add("error"));
        return;
      }
      if (!valdTjocklek) {
        kundOut.textContent = "Välj en tjocklek.";
        document.querySelectorAll('.tjocklek-buttons button').forEach(b => b.classList.add("error"));
        return;
      }

      const bpl = bradorPerLager[valdDimension];
      const totBrador = plank * 2;
      const [minLager, maxLager] = (valdTjocklek === 28) ? [12, 21] : [16, 28];

      paketLista = [];
      let totalKundBrador = 0;

      kundVarden.forEach((kundBr, kundIndex) => {
        const kundLager = Math.ceil(kundBr / bpl);
        const lagerLista = paketfordelning(kundLager, minLager, maxLager);
        lagerLista.forEach(l => {
          paketLista.push({ typ: 'kund', kund: kundIndex + 1, lager: l, varde: l * bpl });
        });
        totalKundBrador += lagerLista.reduce((sum, l) => sum + l * bpl, 0);
      });

      let kvar = totBrador - totalKundBrador;

      if (kvar < 0) {
        varning.innerHTML = `❗ <b>Det saknas ${Math.abs(kvar / 2)} plank</b> för att täcka kundernas behov.`;
      }

      if (kvar > 0) {
        const restLager = Math.ceil(kvar / bpl);
        const restPak = paketfordelning(restLager, minLager, maxLager);
        restPak.forEach(l => {
          paketLista.push({ typ: 'rest', lager: l, varde: Math.min(l * bpl, kvar) });
          kvar -= l * bpl;
        });
      }

      aktuellIndex = 0;
      visaPaket();
    }

    function visaPaket() {
      const kundOut = document.getElementById("kundOut");
      const restOut = document.getElementById("restOut");
      kundOut.textContent = "";
      restOut.textContent = "";

      const kunder = paketLista.filter(p => p.typ === 'kund').reduce((acc, p) => {
        if (!acc[p.kund]) acc[p.kund] = [];
        acc[p.kund].push(p);
        return acc;
      }, {});

      let kundText = "";
      for (const [kundNr, paket] of Object.entries(kunder)) {
        const totalBr = paket.reduce((sum, p) => sum + p.varde, 0);
        const totalLag = paket.reduce((sum, p) => sum + p.lager, 0);
        kundText += `Kund ${kundNr}:
Totalt ${totalLag} lager ⇒ ${paket.length} paket
`;

        const markeradLager = paket.map((p, i) => {
          const index = paketLista.indexOf(p);
          return (index === aktuellIndex ? `<span class='bold'>${p.lager}</span>` : p.lager);
        });

        const markeradBrador = paket.map((p, i) => {
          const index = paketLista.indexOf(p);
          return (index === aktuellIndex ? `<span class='bold'>${p.varde}</span>` : p.varde);
        });

        kundText += `  Lager: ${markeradLager.join(', ')}
`;
        kundText += `  Brädor: ${markeradBrador.join(', ')}

`;
      }

      const restPak = paketLista.filter(p => p.typ === 'rest');
      const restText = restPak.length ? `Resterande paket:
Antal paket: ${restPak.length}
Lager per paket: ${restPak.map((p, i) => (aktuellIndex === paketLista.indexOf(p) ? `<span class='bold'>${p.lager}</span>` : p.lager)).join(', ')}
Brädor per paket: ${restPak.map((p, i) => (aktuellIndex === paketLista.indexOf(p) ? `<span class='bold'>${p.varde}</span>` : p.varde)).join(', ')}` : "";

      kundOut.innerHTML = kundText;
      restOut.innerHTML = restText;
    }

    function visaNasta() {
      if (aktuellIndex < paketLista.length - 1) {
        aktuellIndex++;
        visaPaket();
      }
    }

    function visaForra() {
      if (aktuellIndex > 0) {
        aktuellIndex--;
        visaPaket();
      }
    }

    window.onload = () => {
      laggTillKund();
    };
  </script>
</body>
</html>
