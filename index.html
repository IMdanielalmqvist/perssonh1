<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 2rem;
    }
    .logo {
      display: flex;
      align-items: flex-start;
      margin-top: -6rem;
      margin-bottom: -3.5rem;
      margin-left: -1.2rem;
    }
    .logo img {
      height: 300px;
    }
    label, input, button {
      display: block;
      margin: 1rem 0 0.5rem;
    }
    .selector-container {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }
    .dimension-buttons, .tjocklek-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .dimension-buttons button, .tjocklek-buttons button {
      padding: 0.3rem 0.6rem;
      background-color: #fff;
      color: #000;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      min-width: 2.5rem;
      min-height: 1.8rem;
    }
    .dimension-buttons button.active, .tjocklek-buttons button.active {
      background-color: #444;
      color: #fff;
    }
    .dimension-buttons button.error, .tjocklek-buttons button.error {
      border: 2px solid red;
    }
    .result {
      margin-top: 2rem;
      white-space: pre-line;
    }
    .bold {
      font-weight: bold;
      text-decoration: underline;
    }
    .navigation-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="logo.png" alt="Perssons logotyp" />
  </div>

  <label for="plank">Antal plank:</label>
  <input type="number" id="plank" />

  <div class="selector-container">
    <div>
      <label>Välj dimension:</label>
      <div class="dimension-buttons" id="dimension-buttons"></div>
    </div>
    <div>
      <label>Välj tjocklek:</label>
      <div class="tjocklek-buttons" id="tjocklek-buttons"></div>
    </div>
  </div>

  <label for="kund">Brädor till kund:</label>
  <input type="number" id="kund" />

  <button onclick="berakna()">Beräkna</button>

  <div class="result" id="kundOut"></div>
  <div class="result" id="restOut"></div>

  <div class="navigation-buttons">
    <button onclick="visaForra()">Föregående paket</button>
    <button onclick="visaNasta()">Nästa paket</button>
  </div>

  <script>
    const bradorPerLager = { 4: 11, 5: 9, 6: 7, 7: 6, 8: 5, 9: 5 };
    let valdDimension = 0;
    let valdTjocklek = 0;
    let paketLista = [];
    let aktuellIndex = 0;
    let senasteKund = 0;
    let senasteFaktiska = 0;
    let senasteTotBrador = 0;
    let senasteKundLager = 0;
    let kundPak = [], restPak = [];

    const knappContainer = document.getElementById('dimension-buttons');
    [4,5,6,7,8,9].forEach(d => {
      const btn = document.createElement('button');
      btn.textContent = d;
      btn.onclick = () => {
        valdDimension = d;
        document.querySelectorAll('.dimension-buttons button').forEach(b => b.classList.remove("active", "error"));
        btn.classList.add("active");
      };
      knappContainer.appendChild(btn);
    });

    const tjocklekContainer = document.getElementById('tjocklek-buttons');
    [21, 28].forEach(t => {
      const btn = document.createElement('button');
      btn.textContent = t;
      btn.onclick = () => {
        valdTjocklek = t;
        document.querySelectorAll('.tjocklek-buttons button').forEach(b => b.classList.remove("active", "error"));
        btn.classList.add("active");
      };
      tjocklekContainer.appendChild(btn);
    });

    function paketfordelning(lager, minLager, maxLager) {
      if (lager < minLager) return [lager];
      for (let antal = 1; antal <= lager; antal++) {
        let bas = Math.floor(lager / antal);
        if (bas < minLager || bas > maxLager) continue;
        let lista = Array(antal).fill(bas);
        let extra = lager - bas * antal;
        for (let i = 0; i < lista.length && extra > 0; i++) {
          if (lista[i] < maxLager) {
            lista[i]++;
            extra--;
          }
        }
        if (extra === 0) return lista;
      }
      return [lager];
    }

    function berakna() {
      const kundOut = document.getElementById("kundOut");
      const restOut = document.getElementById("restOut");
      const plank = parseInt(document.getElementById("plank").value) || 0;
      const kund = parseInt(document.getElementById("kund").value) || 0;

      if (!plank || !kund) {
        kundOut.textContent = "Fyll i antal plank och antal brädor till kund.";
        restOut.textContent = "";
        return;
      }
      if (!valdDimension) {
        kundOut.textContent = "Välj en dimension.";
        restOut.textContent = "";
        document.querySelectorAll('.dimension-buttons button').forEach(b => b.classList.add("error"));
        return;
      }
      if (!valdTjocklek) {
        kundOut.textContent = "Välj en tjocklek.";
        restOut.textContent = "";
        document.querySelectorAll('.tjocklek-buttons button').forEach(b => b.classList.add("error"));
        return;
      }

      const bpl = bradorPerLager[valdDimension];
      const totBrador = plank * 2;
      const kundLager = Math.ceil(kund / bpl);
      const [minLager, maxLager] = (valdTjocklek === 28) ? [12, 21] : [16, 28];

      kundPak = paketfordelning(kundLager, minLager, maxLager);
      const kundBrador = kundPak.map(l => l * bpl);
      const faktiska = kundBrador.reduce((a,b) => a + b, 0);
      const kvar = totBrador - faktiska;
      const restLager = Math.ceil(kvar / bpl);
      restPak = paketfordelning(restLager, minLager, maxLager);
      const restBrador = restPak.map(l => Math.min(l * bpl, kvar));

      paketLista = [...kundBrador.map((b, i) => ({ typ: 'kund', varde: b, lager: kundPak[i] })), ...restBrador.map((b, i) => ({ typ: 'rest', varde: b, lager: restPak[i] }))];
      aktuellIndex = 0;
      senasteKund = kund;
      senasteFaktiska = faktiska;
      senasteTotBrador = totBrador;
      senasteKundLager = kundLager;
      visaPaket();
    }

    function visaPaket() {
      const kundOut = document.getElementById("kundOut");
      const restOut = document.getElementById("restOut");
      kundOut.textContent = "";
      restOut.textContent = "";

      const markerad = paketLista.map((p, i) => i === aktuellIndex ? `<span class='bold'>${p.varde}</span>` : `${p.varde}`);
      const markeradLager = paketLista.map((p, i) => i === aktuellIndex ? `<span class='bold'>${p.lager}</span>` : `${p.lager}`);

      const kundPaket = paketLista.filter(p => p.typ === 'kund');
      const restPaket = paketLista.filter(p => p.typ === 'rest');

      const kundText = kundPaket.length
        ? `Brädor totalt: ${senasteTotBrador}
Brädor till kund: ${senasteKund} → ${senasteKundLager} lager = ${senasteFaktiska} brädor${senasteFaktiska>senasteKund ? ` (+${senasteFaktiska - senasteKund} extra)` : ''}

Kundens paket:
Antal paket: ${kundPaket.length}
Brädor per paket: ${markerad.slice(0, kundPaket.length).join(', ')}
Lager per paket: ${markeradLager.slice(0, kundPaket.length).join(', ')}`
        : "";
      const restText = restPaket.length
        ? `Resterande paket:
Antal paket: ${restPaket.length}
Brädor per paket: ${markerad.slice(kundPaket.length).join(', ')}
Lager per paket: ${markeradLager.slice(kundPaket.length).join(', ')}`
        : "";

      kundOut.innerHTML = kundText;
      restOut.innerHTML = restText;
    }

    function visaNasta() {
      if (aktuellIndex < paketLista.length - 1) {
        aktuellIndex++;
        visaPaket();
      }
    }

    function visaForra() {
      if (aktuellIndex > 0) {
        aktuellIndex--;
        visaPaket();
      }
    }
  </script>
</body>
</html>
